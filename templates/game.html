<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cookie Clicker</title>
<style>
body { font-family: Arial,sans-serif; background-color: #fff5c2; margin:0; color:#5a3e1b; }
.container { display:flex; flex-direction:column; gap:15px; padding:15px; }
@media(min-width:768px){ .container{ flex-direction:row; } }
.section{ background:#ffe49c; border-radius:15px; padding:20px; flex:1; min-width:200px; box-shadow:0 4px 10px rgba(0,0,0,0.15);}
.left,.right{ flex:1; }
.center{ flex:2; display:flex; flex-direction:column; gap:10px; }
#cookie{ width:120px; height:120px; max-width:80%; background-image: url('/static/cookie.png'); background-size:cover; border-radius:50%; margin:0 auto; cursor:pointer; transition:transform 0.1s;}
#cookie:active{ transform:scale(0.95); }
#cookie-count{ text-align:center; margin-top:10px; font-size:1.5em; font-weight:bold;}
.upgrade { display:flex; justify-content:space-between; padding:10px; border-radius:10px; background-color:#fff3b0; box-shadow:0 2px 4px rgba(0,0,0,0.1); font-size:1em; }
.upgrade-name { font-weight:bold; }
</style>
</head>
<body>
<div class="container">
    <!-- Левая секция: печенье -->
    <div class="section left">
        <div id="cookie"></div>
        <div id="cookie-count">0 печений</div>
    </div>

    <!-- Центральная секция: апгрейды -->
    <div class="section center">
        <h2>Апгрейды</h2>
        <div id="upgrades"></div>
    </div>

    <!-- Правая секция: магазин -->
    <div class="section right">
        <h2>Магазин</h2>
        <div id="shop"></div>
    </div>
</div>

<script>
const cookieElem = document.getElementById('cookie');
const cookieCountElem = document.getElementById('cookie-count');
const upgradesContainer = document.getElementById('upgrades');

// Функция для обновления данных на странице
async function updateUserData() {
    try {
        const res = await fetch('/cookie_game', { method: 'POST' });
        const data = await res.json();

        // Обновляем количество печений
        cookieCountElem.textContent = data.cookies + " печений";

        // Обновляем апгрейды, только с level > 0
        upgradesContainer.innerHTML = '';
        for (const key in data.upgrades) {
            const u = data.upgrades[key];
            if (u.level > 0) {
                const div = document.createElement('div');
                div.className = 'upgrade';
                div.innerHTML = `<span class="upgrade-name">${key}</span> <span>Уровень: ${u.level}</span>`;
                upgradesContainer.appendChild(div);
            }
        }

    } catch (err) {
        console.error("Ошибка при загрузке данных:", err);
    }
}

cookieElem.addEventListener('click', async () => {
    try {
        await fetch('/click', { method: 'POST' });
        await updateUserData();
    } catch (err) {
        console.error("Ошибка при клике:", err);
    }
});

document.addEventListener("DOMContentLoaded", () => {
    updateUserData();
});
</script>
</body>
</html>
